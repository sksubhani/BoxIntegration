# BoxIntegration
How to integrate your Java applications with Box (Box API)

# Introduction:
There are 3 ways we can talk to Box system using the Box SDK (API) from Java applications.
1. Using the developer token
2. Using Box login web page during navigation
3. Using Box SDK with background connection (no UI interaction required)

# What we need to know:
Before we connect to Box from Java application, please make sure you have the below:
  1. Valid Box account. <br/>
   With this step, you have "user id" and "password"
   
  2. An application on Box (lets us say, "<b>java_box_connect_app </b>") <br/>
  Link: https://app.box.com/developers/services/edit/) <br/>
  With this step, you have "application name", "client_id", "client_secret", "api key"
  
# BOX Configuration details:
* <b> OAuth2 Parameters:</b>  <br/>
 "client_id", "client_secret", "api key" are generated by Box for you.  <br/> <br/>
 * <b> Redirect URI:</b> You can give any localhost url or your application url (Eg: http://localhost:8080)  <br/>  <br/>
 * <b> Authentication Type:</b> Traditional web page login uses standard auth (3 legged O Auth 2.0). But, we will use Server Auth (O Auth 2.0 with JWT)  <br/>  <br/>
 * <b> User Access:</b> Depending on what level of access for your application, select that.  <br/>  <br/>
 * <b> Scopes:</b> Select the levels of access you want to give to the users / other apps to Box app.  <br/> 
         If you want to manage users, etc, select the enterprise options as well.  <br/>  <br/>
 * <b> Advanced Features:</b> Check the box for generate access tokens for users  <br/>  <br/>
 * <b> Developer Token:</b> If you want try without all these settings, click on "Create a Developer Token" and you can use it. Otherwise, no need to generate this token here.  <br/>  <br/>
    
    
 # Key Management:
   This link should also help you:  <br/> https://docs.box.com/docs/app-auth#section-1-generating-an-rsa-keypair <br/> 

 In order to authenticate, we need to generate Public and Private keys. <br/> 
 # Generating Public / Private Keys On Windows OS: 
   * Install Cygwin tool (basic version is enough) <br/>
   * Download and install based on your OS version from this link: <br/>
       https://cygwin.com/install.html </br>
   * Clone OpenSSL repo into local machine. <br/>
     This link helps: https://www.openssl.org/source/  <br/>
     Git repo: https://github.com/openssl/openssl.git
   * In your local machine, create a folder "Openssl" and run the command: <br/> 
   <b> git clone https://github.com/openssl/openssl.git   </b> <br/>
    * This will get all the files from the git repo and keeps them in local to run the commands to generate the keys in next steps.
    * Once the openssl is installed (git repo is cloned. There is no installation for this), run the below commands.

    * Now Open "cygwin". This opens a command line editor. Run the below commands.  <br/>
       
# Private key generation:  
   * Run the below command in Cygwin command line editor. <br/>
   <b> $ openssl genrsa -aes256 -out private_key.pem 2048  </b> <br/>
   * This will asks you to enter a pass phrase for the private key file.  <br/>
   * This is like a password for your file to open.  <br/>
   * Enter a <b> word </b> or sentence and keep it secret.   <br/>
   * We need this word in future to open the file by our java application.  <br/>
       
# Public key generation:  
   * Run the below command in Cygwin command line editor.  <br/>
   <b> $ openssl rsa -pubout -in private_key.pem -out public_key.pem  </b> <br/>
   <b> Note: </b> The public key is generated based on the private key file.   <br/>
   * Now, type $ ls in the command line and you will see two files.  <br/>
      
   1. private_key.pem  <br/>
   2. public_key.pem  <br/>

   * Keep these files safe in a hidden folder or secure folder. We need to refer these files in our java code. <br/>
   * Now, go back to Box application editable page.  <br/>
      
# BOX application configuration (contd)
      
   * Click on "Add Public Key" button. It opens a window. 
   * From the public key generated in the above step, get the content of the file and past in this public key box. 
   * Click on "Verify" button. 
   * Box will tell you whether the key is accepted or not based on the format and some validations it performs. 
   * If it is accepted, Save it. This will generate a <b> Key ID </b> (Public Key ID) which we need to use in our java application. <br/>
   * At the bottom, there will be a <b> api key </b> field. Keep a note of this value. We will use this in our java application.

   # Other Security related changes in our machine:
   * The default Java security standards may not be sufficient in order to run the encryption / decryption mechanism.  <br/>
   * We need to download the latest JCE jars and keep in our machine. <br/>
   * Go to "http://www.oracle.com/technetwork/java/javase/downloads/index.html" and search for "JCE".  <br/>
   * Click on the "Download" button against "Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files for JDK/JRE" with the Java version you are running.  <br/>

   * Follow the instuctions in the Instructions file.   <br/>

   * <b> Summary of this file: </b> There will be two jars inside the directory once you extract.
   Go to Program Files > Java > JDK version > jre > lib > security > 
   (C:\Program Files\Java\jdk1.8.0_102\jre\lib\security)
      ** Copy these two jar files  "local_policy" and "US_export_policy" from this and keep in a new folder as a backup.
      ** Copy the two jars which we downloaded into this "security" folder. The backup folder is useful if we want to revert the changes.

   * Now, Save the application on Box.  <br/> 
   * We do not need to make these security related changes in Heroku / Box. These are for local machine to run the encryption with latest standards which does not comes with default JDK / JRE. <br/> <br/>
      
      
# Enterprise level changes:
      
   * Login into Box Admin Console. <br/>
   * Go to Enterprise Settings / Business Settings box system.  <br/>
   * This can be done by clicking on the "Settings" icon on top right side next to the search box.   <br/>
   * This link can take you there: https://app.box.com/master/settings  <br/>

   * Click on "Apps" tab.  <br/>
   * Under "Custom Applications", click on "Authorize New App" button.   <br/>
   * Enter the name of the app we gave in Box when we created earlier. (Eg: We gave the name "java_box_connect_app" earlier) <br/>

   * It asks for the "API Key". Provide the api key which we noted earlier.  <br/>
   * This is available in the app edit page (https://app.box.com/developers/services/ and then select the app name, navigate to the bottom of the page or search for the keyword)
   
   # If creating the application in an organization:
   * The Application Name and the API key need to be sent to Box Admin and ask to Authorize the appliacation.
      
# Create the Java program and Run:
    
   * Go to <br/> 
   https://github.com/box/box-java-sdk/blob/master/src/example/java/com/box/sdk/example/AccessAsAppUser.java
   <br/> OR <br/>
   https://github.com/box/box-java-sdk/blob/master/src/example/java/com/box/sdk/example/CreateAppUser.java

   * We need to save the private key content from the cygwin and save in local machine. Use the file path in the code to read from.

